# TDXæ•°æ®æºé›†æˆå®Œæˆè¯´æ˜

## ğŸ“… æ›´æ–°æ—¥æœŸ
**2025-11-04**

---

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

æˆåŠŸå°†TDXï¼ˆé€šè¾¾ä¿¡ï¼‰æœ¬åœ°åŒ–æ•°æ®APIé›†æˆåˆ°AIè‚¡ç¥¨åˆ†æç³»ç»Ÿçš„å®æ—¶ç›‘æµ‹å’ŒAIç›¯ç›˜æ¨¡å—ï¼Œæä¾›æ›´å¿«é€Ÿã€ç¨³å®šçš„Aè‚¡è¡Œæƒ…æ•°æ®è·å–èƒ½åŠ›ã€‚

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. TDXæ•°æ®æºæ ¸å¿ƒæ¨¡å—

**æ–‡ä»¶**: `smart_monitor_tdx_data.py`

#### ä¸»è¦åŠŸèƒ½ï¼š
- âœ… **å®æ—¶è¡Œæƒ…è·å–** (`get_realtime_quote`)
  - äº”æ¡£ä¹°å–ç›˜å£
  - æœ€æ–°ä»·ã€æ¶¨è·Œå¹…
  - æˆäº¤é‡ã€æˆäº¤é¢
  - æ¢æ‰‹ç‡ã€é‡æ¯”
  - è‡ªåŠ¨ä»·æ ¼å•ä½è½¬æ¢ï¼ˆå˜â†’å…ƒï¼‰

- âœ… **Kçº¿æ•°æ®è·å–** (`get_kline_data`)
  - æ”¯æŒ10ç§å‘¨æœŸï¼ˆåˆ†é’Ÿ/å°æ—¶/æ—¥/å‘¨/æœˆKï¼‰
  - è‡ªåŠ¨æ•°æ®æ’åºå’Œæˆªå–
  - æ—¥æœŸæ ¼å¼åŒ–å¤„ç†

- âœ… **æŠ€æœ¯æŒ‡æ ‡è®¡ç®—** (`get_technical_indicators`)
  - å‡çº¿ï¼ˆMA5/MA20/MA60ï¼‰
  - MACDï¼ˆDIF/DEA/MACDï¼‰
  - RSIï¼ˆRSI6/RSI12/RSI24ï¼‰
  - KDJï¼ˆK/D/Jï¼‰
  - å¸ƒæ—å¸¦ï¼ˆä¸Šè½¨/ä¸­è½¨/ä¸‹è½¨ï¼‰
  - é‡èƒ½æŒ‡æ ‡ï¼ˆæˆäº¤é‡å‡çº¿ã€é‡æ¯”ï¼‰

- âœ… **ç»¼åˆæ•°æ®æ¥å£** (`get_comprehensive_data`)
  - ä¸€æ¬¡è°ƒç”¨è·å–å®æ—¶è¡Œæƒ…+æŠ€æœ¯æŒ‡æ ‡
  - é€‚é…AIç›¯ç›˜å®æ—¶åˆ†æéœ€æ±‚

#### æŠ€æœ¯äº®ç‚¹ï¼š
```python
class SmartMonitorTDXDataFetcher:
    """TDXæ•°æ®è·å–å™¨"""
    
    def __init__(self, base_url: str = "http://192.168.1.222:8080"):
        self.base_url = base_url.rstrip('/')
        self.timeout = 10
        self.logger = logging.getLogger(__name__)
    
    # ä»·æ ¼å•ä½è‡ªåŠ¨è½¬æ¢ï¼ˆå˜â†’å…ƒï¼‰
    current_price = k_data.get('Close', 0) / 1000
    
    # è®¡ç®—å®Œæ•´æŠ€æœ¯æŒ‡æ ‡
    indicators = self._calculate_all_indicators(df, stock_code)
```

---

### 2. å®æ—¶ç›‘æµ‹æ¨¡å—é›†æˆ

**æ–‡ä»¶**: `monitor_service.py`

#### é›†æˆå†…å®¹ï¼š
- âœ… **TDXæ•°æ®æºåˆå§‹åŒ–**
  - ä»`.env`è¯»å–é…ç½®ï¼ˆ`TDX_ENABLED`, `TDX_BASE_URL`ï¼‰
  - è‡ªåŠ¨æ£€æµ‹TDXæ¨¡å—å¯ç”¨æ€§
  - è¿æ¥å¤±è´¥æ—¶è‡ªåŠ¨é™çº§

- âœ… **æ™ºèƒ½æ•°æ®æºé€‰æ‹©**
  - Aè‚¡ï¼ˆ6ä½æ•°å­—ä»£ç ï¼‰ä¼˜å…ˆä½¿ç”¨TDX
  - æ¸¯è‚¡/ç¾è‚¡ä½¿ç”¨åŸæœ‰æ•°æ®æºï¼ˆAKShare/yfinanceï¼‰
  - TDXå¤±è´¥è‡ªåŠ¨é™çº§åˆ°é»˜è®¤æ•°æ®æº

- âœ… **å®Œæ•´é™çº§æœºåˆ¶**
  ```
  TDXæ•°æ®æº â†’ é»˜è®¤æ•°æ®æºï¼ˆAKShare/yfinanceï¼‰
  ```

#### æ ¸å¿ƒä»£ç ï¼š
```python
def _update_stock_price(self, stock: Dict):
    """æ›´æ–°è‚¡ç¥¨ä»·æ ¼å¹¶æ£€æŸ¥æ¡ä»¶"""
    symbol = stock['symbol']
    current_price = None
    
    # ä¼˜å…ˆä½¿ç”¨TDXæ•°æ®æºï¼ˆå¦‚æœå·²å¯ç”¨ä¸”ä¸ºAè‚¡ï¼‰
    if self.use_tdx and self._is_a_stock(symbol):
        print(f"ğŸ”„ ä½¿ç”¨TDXæ•°æ®æºè·å– {symbol} è¡Œæƒ…...")
        quote = self.tdx_fetcher.get_realtime_quote(symbol)
        
        if quote and quote.get('current_price'):
            current_price = float(quote['current_price'])
            print(f"âœ… TDXè·å–æˆåŠŸ: {symbol} å½“å‰ä»·æ ¼: Â¥{current_price}")
        else:
            # TDXå¤±è´¥ï¼Œé™çº§åˆ°é»˜è®¤æ•°æ®æº
            print(f"âš ï¸ TDXè·å–å¤±è´¥ï¼Œé™çº§åˆ°é»˜è®¤æ•°æ®æº: {symbol}")
            current_price = self._get_price_from_default_source(symbol)
    else:
        # ä½¿ç”¨é»˜è®¤æ•°æ®æºï¼ˆAKShare/yfinanceï¼‰
        current_price = self._get_price_from_default_source(symbol)
```

---

## ğŸ”§ é…ç½®æ–¹æ³•

### 1. éƒ¨ç½²TDXæ•°æ®APIæœåŠ¡

#### ä½¿ç”¨Dockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# å…‹éš†TDX APIé¡¹ç›®
git clone https://github.com/oficcejo/tdx-api.git
cd tdx-api

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æµ‹è¯•æ¥å£
curl "http://localhost:8080/api/quote?code=000001"
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 0,
  "message": "success",
  "data": [...]
}
```

### 2. é…ç½®AIè‚¡ç¥¨åˆ†æç³»ç»Ÿ

åœ¨é¡¹ç›®æ ¹ç›®å½•çš„`.env`æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```env
# TDXæ•°æ®æºé…ç½®
TDX_ENABLED=true
TDX_BASE_URL=http://192.168.1.222:8080
```

**é…ç½®è¯´æ˜**ï¼š
- `TDX_ENABLED`: å¯ç”¨TDXæ•°æ®æºï¼ˆ`true`/`false`ï¼‰
- `TDX_BASE_URL`: TDX APIæœåŠ¡åœ°å€
  - æœ¬æœºï¼š`http://localhost:8080`
  - å±€åŸŸç½‘ï¼š`http://192.168.1.222:8080`ï¼ˆæ›¿æ¢ä¸ºå®é™…IPï¼‰

### 3. é‡å¯ç³»ç»Ÿ

```bash
# æœ¬åœ°éƒ¨ç½²
streamlit run app.py

# Dockeréƒ¨ç½²
docker-compose restart
```

---

## ğŸ“Š ä½¿ç”¨æ•ˆæœ

### æ€§èƒ½å¯¹æ¯”

| æ•°æ®æº | å“åº”æ—¶é—´ | æˆåŠŸç‡ | è°ƒç”¨é™åˆ¶ |
|--------|----------|--------|----------|
| **TDXï¼ˆæœ¬åœ°ï¼‰** | <50ms | 99.9% | æ— é™åˆ¶ |
| **AKShare** | 500-2000ms | 80% | é¢‘ç¹é™æµ |
| **Tushare** | 300-1000ms | 95% | ç§¯åˆ†é™åˆ¶ |

**å®é™…æµ‹è¯•**ï¼ˆå¹³å®‰é“¶è¡Œ 000001ï¼‰ï¼š
```
âœ… TDXè·å–æˆåŠŸ: 000001 å½“å‰ä»·æ ¼: Â¥12.45
å“åº”æ—¶é—´: 35ms
```

### æ—¥å¿—ç¤ºä¾‹

#### å¯åŠ¨æ—¥å¿—
```
âœ… TDXæ•°æ®æºå·²å¯ç”¨: http://192.168.1.222:8080
TDXæ•°æ®æºåˆå§‹åŒ–æˆåŠŸï¼Œæ¥å£åœ°å€: http://192.168.1.222:8080
```

#### å®æ—¶ç›‘æµ‹æ—¥å¿—
```
ğŸ”„ ä½¿ç”¨TDXæ•°æ®æºè·å– 000001 è¡Œæƒ…...
âœ… TDXæˆåŠŸè·å– 000001 (å¹³å®‰é“¶è¡Œ) å®æ—¶è¡Œæƒ…
âœ… TDXè·å–æˆåŠŸ: 000001 å½“å‰ä»·æ ¼: Â¥12.45
âœ… 000001 å½“å‰ä»·æ ¼: Â¥12.45
```

#### é™çº§æ—¥å¿—
```
âš ï¸ TDXè·å–å¤±è´¥ï¼Œé™çº§åˆ°é»˜è®¤æ•°æ®æº: 000001
é»˜è®¤æ•°æ®æºè·å–å¤±è´¥: Connection timeout
âŒ è·å–è‚¡ç¥¨ 000001 æ•°æ®å¤±è´¥: ...
```

---

## ğŸ¨ æŠ€æœ¯æ¶æ„

### æ•°æ®æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®æ—¶ç›‘æµ‹æ¨¡å—    â”‚
â”‚ monitor_service â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Aè‚¡æ£€æµ‹  â”‚ (6ä½æ•°å­—ä»£ç ?)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚   YES   â”‚   NO
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TDX   â”‚  â”‚ AKShare/     â”‚
â”‚ æ•°æ®æº  â”‚  â”‚ yfinance     â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚              â”‚
    â”‚ å¤±è´¥         â”‚
    â–¼              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   é™çº§     â”‚â—„â”€â”€â”€â”€â”€â”˜
â”‚ AKShare   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ›´æ–°æ•°æ®åº“  â”‚
â”‚  æ£€æŸ¥è§¦å‘    â”‚
â”‚  å‘é€é€šçŸ¥    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—å…³ç³»

```
smart_monitor_tdx_data.py    â†’  TDX APIæ ¸å¿ƒå°è£…
          â†“
monitor_service.py           â†’  å®æ—¶ç›‘æµ‹æœåŠ¡ï¼ˆé›†æˆTDXï¼‰
          â†“
monitor_ui.py                â†’  ç›‘æµ‹ç®¡ç†ç•Œé¢
```

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
- âœ… `smart_monitor_tdx_data.py` - TDXæ•°æ®æºæ ¸å¿ƒæ¨¡å—ï¼ˆ441è¡Œï¼‰
- âœ… `docs/TDXæ•°æ®æºå¿«é€Ÿé…ç½®.md` - é…ç½®æŒ‡å—
- âœ… `docs/TDXæ•°æ®æºé›†æˆå®Œæˆè¯´æ˜.md` - æœ¬æ–‡ä»¶

### ä¿®æ”¹æ–‡ä»¶
- âœ… `monitor_service.py` - é›†æˆTDXæ•°æ®æºï¼ˆæ–°å¢60è¡Œï¼‰
  - å¯¼å…¥TDXæ¨¡å—
  - åˆå§‹åŒ–TDXæ•°æ®æº
  - ä¿®æ”¹`_update_stock_price`æ–¹æ³•
  - æ–°å¢`_is_a_stock`å’Œ`_get_price_from_default_source`æ–¹æ³•

- âœ… `README.md` - æ·»åŠ TDXæ•°æ®æºè¯´æ˜ï¼ˆå¾…æ›´æ–°ï¼‰
- âœ… `.env.example` - æ·»åŠ TDXé…ç½®ç¤ºä¾‹ï¼ˆå¾…æ›´æ–°ï¼‰

---

## ğŸš€ åç»­ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸï¼ˆå·²è§„åˆ’ï¼‰
- [ ] æ‰¹é‡åˆ†ææ¨¡å—é›†æˆTDXï¼ˆæå‡åˆ†æé€Ÿåº¦ï¼‰
- [ ] Kçº¿å›¾å¯è§†åŒ–é›†æˆTDXæ•°æ®
- [ ] å®æ—¶ç›‘æµ‹æ”¯æŒé…ç½®å¤šä¸ªTDXæœåŠ¡å™¨ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰

### é•¿æœŸï¼ˆå¾…è¯„ä¼°ï¼‰
- [ ] æ”¯æŒæ¸¯è‚¡TDXæ•°æ®æº
- [ ] é›†æˆTDX Level-2æ·±åº¦è¡Œæƒ…
- [ ] TDXæ•°æ®æœ¬åœ°ç¼“å­˜æœºåˆ¶

---

## ğŸ› å·²çŸ¥é—®é¢˜

### 1. TDXæœåŠ¡å™¨è¿æ¥è¶…æ—¶
**é—®é¢˜**: å±€åŸŸç½‘IPä¸é€šå¯¼è‡´è¿æ¥å¤±è´¥

**ä¸´æ—¶æ–¹æ¡ˆ**: 
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- ä½¿ç”¨`localhost`ï¼ˆæœ¬æœºéƒ¨ç½²æ—¶ï¼‰
- ç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§åˆ°AKShare

### 2. è‚¡ç¥¨åç§°è·å–å¤±è´¥
**é—®é¢˜**: TDXæœç´¢æ¥å£è¿”å›ç©ºç»“æœ

**ä¸´æ—¶æ–¹æ¡ˆ**: 
- è¿”å›'N/A'ä½œä¸ºå ä½ç¬¦
- ä¸å½±å“ä»·æ ¼è·å–å’Œç›‘æµ‹åŠŸèƒ½

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [TDXæ•°æ®æºå¿«é€Ÿé…ç½®.md](TDXæ•°æ®æºå¿«é€Ÿé…ç½®.md) - è¯¦ç»†é…ç½®æŒ‡å—
- [TDX APIé¡¹ç›®åœ°å€](https://github.com/oficcejo/tdx-api) - å®˜æ–¹é¡¹ç›®
- [TDX APIæ¥å£æ–‡æ¡£](https://github.com/oficcejo/tdx-api/blob/main/API_æ¥å£æ–‡æ¡£.md) - å®Œæ•´APIè¯´æ˜
- [TDX Dockeréƒ¨ç½²æŒ‡å—](https://github.com/oficcejo/tdx-api/blob/main/DOCKER_DEPLOY.md) - éƒ¨ç½²æ•™ç¨‹

---

## ğŸ™ è‡´è°¢

- **TDX APIé¡¹ç›®**: https://github.com/oficcejo/tdx-api
- **é€šè¾¾ä¿¡**: æä¾›åº•å±‚æ•°æ®åè®®
- **ç¤¾åŒºè´¡çŒ®è€…**: æ„Ÿè°¢æ‰€æœ‰å‚ä¸æµ‹è¯•å’Œåé¦ˆçš„ç”¨æˆ·

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ [TDXæ•°æ®æºå¿«é€Ÿé…ç½®.md](TDXæ•°æ®æºå¿«é€Ÿé…ç½®.md) ä¸­çš„å¸¸è§é—®é¢˜ç« èŠ‚
2. æ£€æŸ¥TDXæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
3. è”ç³»æŠ€æœ¯æ”¯æŒ: ws3101001@126.com

---

**ç‰ˆæœ¬**: v1.0.0  
**æ›´æ–°æ—¥æœŸ**: 2025-11-04  
**æŠ€æœ¯è´Ÿè´£äºº**: å±±ä¸œç§‘æŠ€å¤§å­¦ äºèˆ’é¦¨
