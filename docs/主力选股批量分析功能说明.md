# 主力选股 - TOP股票批量分析功能

## 📖 功能概述

在主力选股的**候选股票列表**中，对主力资金净流入排名前N的股票提供**一键批量深度分析**功能，参照智瞰龙虎板块的批量分析方式。

---

## 🚀 快速开始

### 1. 进入主力选股

1. 启动应用：`streamlit run app.py`
2. 点击侧边栏 **"🎯 主力选股"**
3. 设置筛选参数，点击 **"🚀 开始主力选股"**
4. 等待系统完成主力资金筛选和整体分析

### 2. 查看候选股票列表

- 系统显示 **"📋 候选股票列表（筛选后）"**
- 列表按主力资金净流入从高到低排序
- 展示股票代码、名称、行业、主力资金、涨跌幅等信息

### 3. 一键批量分析

1. 在候选列表下方找到 **"🚀 批量深度分析"** 功能区
2. 选择分析数量：10只 / 20只 / 30只 / 50只（默认20只）
3. 点击 **"🚀 开始批量分析"** 按钮
4. 选择分析模式：
   - **顺序分析（稳定）**：逐个分析，适合数量较少
   - **并行分析（快速）**：多线程同时分析，适合数量较多
5. 如选择并行分析，设置并行线程数（2-5个，默认3个）
6. 点击 **"🚀 确认开始分析"**
7. 等待进度完成（实时显示进度和状态）

### 4. 查看分析结果

- **统计信息**：总计、成功、失败、耗时
- **成功列表**：每只股票的投资评级、信心度、进场区间、止盈止损
- **详细报告**：点击展开查看完整AI分析报告
- **快捷操作**：一键加入监测列表

---

## 🎯 使用场景

### 场景1：主力资金跟踪

```
主力选股筛选 → 候选列表 → TOP20批量分析 → 选择买入标的
```

**流程**：
1. 主力选股筛选出主力资金净流入前100名股票
2. 批量分析前20只主力资金最多的股票
3. 深度分析获取具体买卖点
4. 加入监测，等待进场机会

### 场景2：资金流向研究

```
主力选股 → 批量分析TOP50 → 对比分析 → 识别强势标的
```

**流程**：
1. 筛选主力资金流入股票
2. 批量分析前50只，全面了解资金流向
3. 对比各股评级和信心度
4. 精选2-3只最优标的重点关注

### 场景3：精选优质股票

```
主力选股 → TOP10深度分析 → 投资组合构建
```

**流程**：
1. 主力选股筛选候选
2. 深度分析前10只主力最青睐的股票
3. 根据评级和关键价位构建投资组合
4. 分散投资，控制风险

---

## 💡 功能特性

### 1. 智能筛选

- ✅ 基于主力资金净流入自动排名
- ✅ 支持选择分析前10/20/30/50只
- ✅ 自动按主力资金降序排序

### 2. 批量分析

- ✅ 支持分析前10/20/30/50只股票
- ✅ 顺序/并行两种模式
- ✅ 实时进度显示
- ✅ **遵循统一调用规范** ⭐️

### 3. 统一结果

- ✅ 使用 `app.analyze_single_stock_for_batch()` 统一函数
- ✅ 统一字段名：`rating`, `confidence_level`, `entry_range`等
- ✅ 统一展示格式：emoji、布局、信息
- ✅ 与首页批量分析、龙虎榜批量分析保持一致

### 4. 快捷操作

- ✅ 一键加入监测列表
- ✅ 自动解析进场区间和止盈止损
- ✅ 直接开启实时监控

---

## 📊 分析维度

### 主力选股筛选（初筛）

| 维度 | 说明 |
|------|------|
| 主力资金净流入 | 问财数据，主力资金排名前100 |
| 市值范围 | 默认50-5000亿，可调整 |
| 涨跌幅控制 | 默认<30%，避免追高 |
| 财务基本面 | 去除ST股票、数据不完整的股票 |

### AI深度分析（精选）

| 维度 | 分析师 | 内容 |
|------|--------|------|
| 技术面 | 技术分析师 | K线、指标、趋势 |
| 基本面 | 基本面分析师 | 财务、估值、成长 |
| 资金面 | 资金流向分析师 | 主力资金、北向资金 |
| 风险面 | 风险管理师 | 风险提示、止损策略 |
| 综合决策 | 团队讨论 | 投资评级、关键价位 |

---

## 🎯 推荐策略

### 保守策略（TOP10）

- **分析数量**：10只
- **分析模式**：顺序分析
- **选股原则**：只选主力资金最多的10只
- **操作策略**：深度分析后选1-2只重点关注

### 积极策略（TOP20）

- **分析数量**：20只
- **分析模式**：并行分析（3线程）
- **选股原则**：主力资金前20只
- **操作策略**：分散持仓，捕捉多个机会

### 全面策略（TOP50）

- **分析数量**：50只
- **分析模式**：并行分析（5线程）
- **选股原则**：全面了解主力资金流向
- **操作策略**：对比分析，精选3-5只最优

---

## ⚙️ 技术实现

### 遵循统一调用规范 ⭐️

**严格遵循 `docs/UNIFIED_ANALYSIS_SPEC.md` 规范：**

1. ✅ 调用统一函数：`app.analyze_single_stock_for_batch()`
2. ✅ 使用统一字段：`rating`, `confidence_level`, `entry_range`, `take_profit`, `stop_loss`
3. ✅ 统一解析逻辑：`split("-")`, `re.findall(r'\d+\.?\d*')`
4. ✅ 统一展示格式：emoji标识、一致布局

### 代码示例

```python
# 调用统一分析函数
from app import analyze_single_stock_for_batch

result = analyze_single_stock_for_batch(
    symbol=code,
    period="1y",
    enabled_analysts_config={
        'technical': True,
        'fundamental': True,
        'fund_flow': True,
        'risk': True,
        'sentiment': False,
        'news': False
    },
    selected_model='deepseek-chat'
)

# 使用统一字段名
final_decision = result["final_decision"]
rating = final_decision.get("rating", "未知")
confidence = final_decision.get("confidence_level", "N/A")
entry_range = final_decision.get("entry_range", "N/A")
```

### 批量分析流程

```
用户点击"开始批量分析"
    ↓
提取TOP N股票代码（按主力资金降序）
    ↓
存储到session_state
    ↓
重新渲染页面
    ↓
检测到批量分析触发标志
    ↓
显示分析配置界面
    ↓
用户确认开始
    ↓
顺序/并行调用统一分析函数
    ↓
显示进度和结果
    ↓
保存结果到session_state
    ↓
展示分析详情
```

---

## 💡 使用技巧

### 1. 最佳分析时机

- **盘后**：主力资金数据更新后
- **早盘前**：开盘前复盘和选股

### 2. 合理选择数量

- **10只**：精选，深度研究
- **20只**：平衡，适合大多数场景（推荐）
- **50只**：全面，了解整体主力资金流向

### 3. 结合主力选股信息

分析时重点关注：
- 主力资金净流入金额
- 区间涨跌幅是否适中
- 所属行业是否景气
- 财务基本面是否健康

### 4. 快速加入监测

- 分析完成后直接点击"加入监测"
- 自动设置进场区间和止盈止损
- 实时监测价格变化
- 及时把握买卖时机

---

## 📈 预期效果

### 输入
- 主力选股候选股票列表
- 主力资金净流入排名TOP N

### 输出
- 每只股票的完整AI分析：
  - 投资评级（买入/持有/卖出）
  - 信心度评分（0-10分）
  - 进场区间
  - 止盈位
  - 止损位
  - 目标价
  - 投资建议

### 后续操作
- 选择优质标的加入监测
- 设置价格告警
- 等待买卖信号
- 严格执行止盈止损

---

## 🆚 功能对比

| 功能 | 主力选股整体分析 | 批量深度分析 |
|------|----------------|------------|
| **目标** | 精选3-5只推荐 | 深度分析TOP N只 |
| **分析方式** | 整体分析+资深研究员决策 | 逐个AI团队分析 |
| **结果** | 推荐理由+投资建议 | 评级+关键价位 |
| **关键价位** | 无 | 有（进场/止盈/止损） |
| **适用** | 快速选股 | 详细决策依据 |

**建议组合使用**：
1. 主力选股整体分析快速获取推荐
2. 批量深度分析TOP20详细评估
3. 对比两种结果，精选最优标的
4. 加入监测等待买点
5. 严格执行交易纪律

---

## 🔧 常见问题

### Q1: 批量分析需要多久？

**A:** 取决于数量和模式：
- 10只顺序：约10-15分钟
- 20只并行(3线程)：约15-20分钟
- 50只并行(5线程)：约25-35分钟

### Q2: 分析多少只合适？

**A:** 建议：
- **新手**：分析10只，重点研究
- **进阶**：分析20只，平衡效率和深度
- **资深**：分析50只，全面了解主力资金流向

### Q3: 批量分析后如何选股？

**A:** 参考以下标准：
1. 投资评级：优选"买入"或"强烈买入"
2. 信心度：≥7分
3. 主力资金：净流入金额大
4. 涨跌幅：适中，避免追高
5. 风险面：无重大风险提示

### Q4: 分析失败怎么办？

**A:** 可能原因和解决：
- 股票代码错误：检查代码格式
- 网络问题：重试或切换顺序模式
- API限流：减少并发线程数
- 数据缺失：该股可能暂停交易或数据不完整

### Q5: 能否保存分析结果？

**A:** 当前版本：
- 结果保存在session_state（关闭页面会丢失）
- 可点击"加入监测"保存关键参数
- 建议截图或导出重要信息

---

## 🎊 更新内容

### 新增功能
- ✅ TOP股票一键批量分析
- ✅ 可选分析数量（10/20/30/50只）
- ✅ 顺序/并行分析模式
- ✅ 实时进度显示
- ✅ 详细结果展示
- ✅ 一键加入监测

### 技术亮点
- ✅ **遵循统一调用规范**：调用 `app.analyze_single_stock_for_batch()`
- ✅ **统一字段使用**：`rating`, `confidence_level`, `entry_range`等
- ✅ **统一解析逻辑**：字符串数值提取标准化
- ✅ **代码复用最大化**：无重复分析逻辑
- ✅ **结果展示一致**：与首页批量分析、龙虎榜批量分析保持一致

---

## 📝 完整流程示例

### 实战案例：主力资金跟踪选股

#### Step 1: 主力选股筛选（获取候选）
```
主力选股 → 设置参数（最近3个月）
→ 开始分析 → 获取主力资金前100名
→ 系统筛选后剩余X只候选股票
```

#### Step 2: 查看候选列表
```
候选股票列表
→ 按主力资金净流入降序排列
→ 查看前20只的主力资金金额和涨跌幅
```

#### Step 3: 批量深度分析
```
选择分析数量：20只
→ 点击"开始批量分析"
→ 选择并行分析（3线程）
→ 确认开始分析
→ 等待15-20分钟完成
```

#### Step 4: 筛选优质标的
```
查看分析结果
→ 筛选条件：
  - 评级：买入/强烈买入
  - 信心度：≥7分
  - 主力资金：排名靠前
  - 涨幅：<20%（避免追高）
→ 精选3-5只重点关注
```

#### Step 5: 加入监测
```
对精选股票点击"➕ 加入监测"
→ 自动设置进场区间、止盈止损
→ 启动实时价格监控
```

#### Step 6: 执行交易
```
次日开盘
→ 监测提醒进入进场区间
→ 买入建仓
→ 监测提醒到达止盈位
→ 卖出止盈
```

---

## 🎯 最佳实践

### 1. 主力资金+AI双重验证

- 不仅看主力资金排名，更要看AI深度分析
- 主力资金大但AI评级"卖出"→ 谨慎
- 主力资金中等但AI评级"买入"→ 关注

### 2. 时间把握

- **最佳分析时间**：盘后或早盘前
- **最佳买入时间**：进入进场区间时
- **最佳止盈时间**：触发止盈位立即卖出

### 3. 风险控制

- 严格遵守AI给出的止损位
- 不因短期波动随意调整
- 仓位控制：单只≤总资金20%
- 主力资金股票有波动，轻仓操作

### 4. 组合策略

- 不要全仓单只股票
- TOP10选2-3只重点
- 分散行业，降低风险
- 部分仓位留作机动

---

## ⚠️ 风险提示

### 主力资金股票特点

- 💰 **资金驱动**：主力资金是重要推动力
- 📈 **波动性**：资金流入流出会导致价格波动
- ⏱️ **时效性**：主力资金流向可能快速变化
- 🎯 **题材性**：可能受市场热点影响

### 注意事项

1. **主力资金流入不代表一定上涨**
2. **注意市场整体趋势和环境**
3. **设置合理的止损位（建议5-10%）**
4. **定期跟踪主力资金变化**
5. **及时调整持仓和策略**

---

## 📚 相关文档

- **统一规范**：`docs/UNIFIED_ANALYSIS_SPEC.md` - 分析调用规范
- **主力选股**：`docs/主力选股使用指南.md` - 主力选股系统介绍
- **龙虎榜批量**：`docs/LONGHUBANG_BATCH_ANALYSIS.md` - 龙虎榜批量分析
- **监测功能**：首页实时监测文档

---

## 🎊 总结

**主力选股批量分析功能**为您提供：

✅ 主力资金筛选快速定位候选
✅ 深度分析精准评估投资价值
✅ 一键加入监测实时跟踪
✅ 完整的主力资金跟踪解决方案

**祝您抓住每一个主力资金驱动的投资机会！** 🎯📈

